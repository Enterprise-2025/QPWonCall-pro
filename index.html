<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>QPWONCall — Sales Copilot</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <!-- ICON SET -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="i-home" viewBox="0 0 24 24"><path d="M3 9.5 12 3l9 6.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1V9.5z"/></symbol>
    <symbol id="i-user" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-9 2.5-9 5.5A1.5 1.5 0 0 0 4.5 21h15A1.5 1.5 0 0 0 21 19.5C21 16.5 17 14 12 14Z"/></symbol>
    <symbol id="i-book" viewBox="0 0 24 24"><path d="M6 3h12a2 2 0 0 1 2 2v16H8a2 2 0 0 1-2-2V3zM4 3h1v16H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z"/></symbol>
    <symbol id="i-kanban" viewBox="0 0 24 24"><path d="M3 4h18v16H3zM6 7h3v10H6zM11 7h3v6h-3zM16 7h3v3h-3z"/></symbol>
    <symbol id="i-gear" viewBox="0 0 24 24"><path d="M12 15a3 3 0 1 0-3-3 3 3 0 0 0 3 3Zm7.4-3a7.4 7.4 0 0 0-.1-1l2-1.6-2-3.5-2.4 1a7.4 7.4 0 0 0-1.7-1l-.3-2.6H9l-.3 2.6a7.4 7.4 0 0 0-1.7 1l-2.4-1-2 3.5 2 1.6a7.4 7.4 0 0 0 0 2l-2 1.6 2 3.5 2.4 1 2.4-1a7.4 7.4 0 0 0 1.7 1l.3 2.6h6l.3-2.6a7.4 7.4 0 0 0 1.7-1l2.4 1 2-3.5-2-1.6a7.4 7.4 0 0 0 .1-1Z"/></symbol>
    <symbol id="i-target" viewBox="0 0 24 24"><path d="M12 22A10 10 0 1 0 2 12a10 10 0 0 0 10 10Zm0-6a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"/></symbol>
    <symbol id="i-calendar" viewBox="0 0 24 24"><path d="M7 2v3M17 2v3M3 8h18M5 5h14a2 2 0 0 1 2 2v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V7a2 2 0 0 1 2-2"/></symbol>
    <symbol id="i-bell" viewBox="0 0 24 24"><path d="M15 18H5a2 2 0 0 1-2-2v-3a7 7 0 0 1 14 0v3a2 2 0 0 1-2 2Zm-6 3a2 2 0 0 0 4 0"/></symbol>
    <symbol id="i-mail" viewBox="0 0 24 24"><path d="M3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Zm0 0 9 7 9-7"/></symbol>
    <symbol id="i-wa" viewBox="0 0 24 24"><path d="M20.5 3.5A11 11 0 0 0 3.4 20.6L2 22l1.7-.4A11 11 0 1 0 20.5 3.5ZM7 8.7c0 4 3.3 7.3 7.3 7.3.8 0 1.6-.1 2.3-.4.3-.1.7 0 .9.2l.6.6a.6.6 0 0 1 0 .9 8.8 8.8 0 0 1-4.7 1.4C9.2 19.7 5 15.6 5 10.7 5 8.9 5.5 7.3 6.3 6c.2-.3.6-.3.9 0l.6.6c.2.2.3.5.2.8-.1.6-.2 1.3-.2 1.3Z"/></symbol>
    <symbol id="i-star" viewBox="0 0 24 24"><path d="m12 2 3 6 7 1-5 5 1 7-6-3-6 3 1-7-5-5 7-1z"/></symbol>
    <symbol id="i-tag" viewBox="0 0 24 24"><path d="M2 12 12 2h6l4 4-10 10H2zM16 6a2 2 0 1 0 2 2 2 2 0 0 0-2-2z"/></symbol>
  </svg>

  <header class="app-header">
    <div class="topbar">
      <div class="brand">
        <span class="logo">QPWON<span>Call</span></span>
        <nav class="nav">
          <button class="tab active" data-view="today"><svg class="ico"><use href="#i-home"/></svg> Oggi</button>
          <button class="tab" data-view="one"><svg class="ico"><use href="#i-user"/></svg> One-Lead</button>
          <button class="tab" data-view="library"><svg class="ico"><use href="#i-book"/></svg> Libreria</button>
          <button class="tab" data-view="pipeline"><svg class="ico"><use href="#i-kanban"/></svg> Pipeline</button>
          <button class="tab" data-view="settings"><svg class="ico"><use href="#i-gear"/></svg> Impostazioni</button>
        </nav>
      </div>
      <div class="controls">
        <div class="quota">
          <div class="quota-top"><svg class="ico"><use href="#i-target"/></svg> Target</div>
          <div class="bar-bg"><div id="quotaFill" class="bar-fill"></div></div>
          <div class="quota-bottom"><b id="quotaVal">0</b>€ / <b id="quotaTar">0</b>€ <span id="quotaPerc">(0%)</span></div>
        </div>
        <div class="kpis">
          <div class="kpi"><span>Leads</span><b id="kTot">0</b></div>
          <div class="kpi"><span>Caldi</span><b id="kHot">0</b></div>
          <div class="kpi"><span>App Oggi</span><b id="kApp">0</b></div>
          <div class="kpi"><span>Recall Oggi</span><b id="kRecall">0</b></div>
          <div class="kpi value"><span>Pipeline</span><b id="kPipe">0</b>€</div>
        </div>
        <div class="clock" id="clock"></div>
      </div>
    </div>
    <div class="toolbar">
      <button id="btnNewLead" class="btn primary">+ Nuovo lead</button>
      <input type="file" id="fileImport" accept=".csv" hidden/>
      <button id="btnImport" class="btn">Import CSV</button>
      <button id="btnExport" class="btn">Export CSV</button>
      <button id="btnClear" class="btn danger">Svuota dati</button>
    </div>
  </header>

  <main class="views">

    <!-- TODAY -->
    <section id="view-today" class="view active">
      <div class="cards">
        <div class="card">
          <h3><svg class="ico"><use href="#i-bell"/></svg> Da fare ora</h3>
          <ul id="todoNow" class="list"></ul>
        </div>
        <div class="card">
          <h3><svg class="ico"><use href="#i-star"/></svg> Priorità</h3>
          <ul id="prioList" class="list"></ul>
        </div>
      </div>
    </section>

    <!-- ONE-LEAD -->
    <section id="view-one" class="view">
      <div id="onePanel" class="one-panel"></div>
      <div class="one-nav">
        <button id="prevLead" class="btn">← Precedente</button>
        <button id="nextLead" class="btn">Successivo →</button>
      </div>
    </section>

    <!-- LIBRARY -->
    <section id="view-library" class="view">
      <div class="cards">
        <div class="card">
          <h3><svg class="ico"><use href="#i-book"/></svg> Casi pratici</h3>
          <div id="caseList" class="list"></div>
        </div>
        <div class="card">
          <h3><svg class="ico"><use href="#i-mail"/></svg> Template</h3>
          <div id="tplList" class="list"></div>
        </div>
      </div>
    </section>

    <!-- PIPELINE -->
    <section id="view-pipeline" class="view">
      <div class="filters">
        <input id="search" placeholder="Cerca struttura / città / tel..." />
        <select id="fState">
          <option value="">Stato: tutti</option>
          <option value="da_lavorare">Da lavorare</option>
          <option value="in_lavorazione">In lavorazione</option>
          <option value="app_fissato">App fissato</option>
          <option value="chiuso">Chiuso</option>
        </select>
        <select id="fHeat">
          <option value="">Calore: tutti</option>
          <option value="caldo">Caldo</option>
          <option value="tiepido">Tiepido</option>
          <option value="freddo">Freddo</option>
        </select>
        <select id="fRecall">
          <option value="">Recall: tutti</option>
          <option value="oggi">Oggi</option>
          <option value="settimana">Settimana</option>
          <option value="no">Senza recall</option>
        </select>
        <input id="fTags" placeholder="Filtra tag (virgole)" />
      </div>
      <div class="kanban">
        <div class="kan-col">
          <h2>Da lavorare <span class="kan-count" id="cntTodo">0</span></h2>
          <ul id="listTodo" class="lead-list"></ul>
        </div>
        <div class="kan-col">
          <h2>In lavorazione <span class="kan-count" id="cntDoing">0</span></h2>
          <ul id="listDoing" class="lead-list"></ul>
        </div>
        <div class="kan-col">
          <h2>App fissato <span class="kan-count" id="cntBooked">0</span></h2>
          <ul id="listBooked" class="lead-list"></ul>
        </div>
        <div class="kan-col">
          <h2>Archiviati <span class="kan-count" id="cntClosed">0</span></h2>
          <ul id="listClosed" class="lead-list"></ul>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="view-settings" class="view">
      <div class="settings-grid">
        <div class="card">
          <h3>Obiettivi</h3>
          <label>Target mensile (€) <input id="sTarget" type="number" min="0" step="100"/></label>
        </div>
        <div class="card">
          <h3>Valori business</h3>
          <label>Valore medio appuntamento (€) <input id="sValAppt" type="number" min="0" step="10"/></label>
          <label>Giorni lavorativi/mese <input id="sWorkDays" type="number" min="1" max="31"/></label>
          <label>Conversione chiamate → app (%) <input id="sConv" type="number" min="0" max="100"/></label>
        </div>
        <div class="card">
          <h3>Valore default per prodotto</h3>
          <label>GipoNext <input id="sValGipo" type="number" min="0" step="50"/></label>
          <label>CRM MioDottore <input id="sValCRM" type="number" min="0" step="50"/></label>
          <label>Visibilità MioDottore <input id="sValVis" type="number" min="0" step="50"/></label>
        </div>
        <div class="card">
          <h3>Scoring “Calore”</h3>
          <label>problema chiamate <input id="wProbCall" type="number" min="0" max="6"/></label>
          <label>overbooking <input id="wOver" type="number" min="0" max="6"/></label>
          <label>priorità riduzione <input id="wPrior" type="number" min="0" max="6"/></label>
          <label>interesse visibilità <input id="wVis" type="number" min="0" max="6"/></label>
          <label>prontezza <input id="wReady" type="number" min="0" max="6"/></label>
          <label>bonus costo≥soglia <input id="wCosto" type="number" min="0" max="6"/></label>
          <label>Soglia costo (€/mese) <input id="wSoglia" type="number" min="0" step="50"/></label>
        </div>
        <div class="card">
          <h3>Template & Firma</h3>
          <label>Firma <input id="sFirma" placeholder="Cordiali saluti, Nome Cognome"/></label>
          <details>
            <summary>Email/WA — personalizza</summary>
            <div class="tpl-grid">
              <div>
                <h4>Freddo</h4>
                <label>Oggetto <input id="tFreSub"/></label>
                <label>Corpo <textarea id="tFreBody" rows="5"></textarea></label>
                <label>WhatsApp <textarea id="tFreWA" rows="3"></textarea></label>
              </div>
              <div>
                <h4>Tiepido</h4>
                <label>Oggetto <input id="tTieSub"/></label>
                <label>Corpo <textarea id="tTieBody" rows="5"></textarea></label>
                <label>WhatsApp <textarea id="tTieWA" rows="3"></textarea></label>
              </div>
              <div>
                <h4>Caldo</h4>
                <label>Oggetto <input id="tCalSub"/></label>
                <label>Corpo <textarea id="tCalBody" rows="5"></textarea></label>
                <label>WhatsApp <textarea id="tCalWA" rows="3"></textarea></label>
              </div>
            </div>
          </details>
        </div>
        <div class="card">
          <h3>WhatsApp</h3>
          <p>Collega/usa WhatsApp Web/Desktop per inviare messaggi dai lead. Puoi testare il collegamento qui.</p>
          <button id="btnWAConnect" class="btn">Collegamento / Test WhatsApp</button>
        </div>
        <div class="card">
          <h3>Salva</h3>
          <button id="saveSettings" class="btn primary">Salva impostazioni</button>
        </div>
      </div>
    </section>

  </main>

  <!-- MODALS -->
  <div id="modalLead" class="modal hidden">
    <div class="dialog">
      <button class="close" data-close="modalLead">×</button>
      <h3>Nuovo lead</h3>
      <div class="grid2">
        <label>Struttura* <input id="mStruttura" required/></label>
        <label>Città* <input id="mCitta" required/></label>
      </div>
      <div class="grid2">
        <label>Referente <input id="mReferente"/></label>
        <label>Telefono <input id="mTelefono" placeholder="es. 39333..."/></label>
      </div>
      <div class="grid2">
        <label>Email <input id="mEmail"/></label>
        <label>Prodotto
          <select id="mProdotto">
            <option value="GipoNext">GipoNext (bundle)</option>
            <option value="CRM MioDottore">CRM MioDottore</option>
            <option value="Visibilità MioDottore">Visibilità MioDottore</option>
          </select>
        </label>
      </div>
      <div class="grid2">
        <label>Valore potenziale € <input id="mValore" type="number" min="0" step="50"/></label>
        <label>Tag (virgole) <input id="mTags" placeholder="es. 50+ medici, Vettore"/></label>
      </div>
      <label>Fonte/Referenza <input id="mFonte"/></label>
      <h4 class="mt">Prequalifica</h4>
      <div class="grid3">
        <label>Tipologia
          <select id="pTipologia">
            <option value="">-</option>
            <option>Studio</option>
            <option>Poliambulatorio</option>
            <option>Diagnostica</option>
          </select>
        </label>
        <label>N. Medici <input id="pMedici" type="number" min="0"/></label>
        <label>Software attuale <input id="pSW"/></label>
      </div>
      <div class="grid3">
        <label>Dimensione
          <select id="pDim">
            <option value="">-</option>
            <option>S</option><option>M</option><option>L</option>
          </select>
        </label>
        <label>Canale richieste
          <select id="pCanale">
            <option value="">-</option>
            <option>Telefono</option><option>Web</option><option>Misto</option>
          </select>
        </label>
        <label>Vincoli <input id="pVincoli" placeholder="Convenzioni, reti..."/></label>
      </div>
      <div class="actions">
        <button id="saveLead" class="btn primary">Salva</button>
      </div>
    </div>
  </div>

  <div id="modalSlots" class="modal hidden">
    <div class="dialog">
      <button class="close" data-close="modalSlots">×</button>
      <h3>Proponi/Appunta slot</h3>
      <p>Scegli uno slot suggerito (modificabile in calendario):</p>
      <div id="slotButtons" class="slot-grid"></div>
      <div class="actions">
        <button class="btn" id="sendSlotsEmail"><svg class="ico"><use href="#i-mail"/></svg> Invia via Email</button>
        <button class="btn" id="sendSlotsWA"><svg class="ico"><use href="#i-wa"/></svg> Invia via WhatsApp</button>
      </div>
    </div>
  </div>

  <div id="modalMail" class="modal hidden">
    <div class="dialog">
      <button class="close" data-close="modalMail">×</button>
      <h3>Messaggio Email</h3>
      <label>Oggetto <input id="mailSubject"/></label>
      <label>Corpo <textarea id="mailBody" rows="9"></textarea></label>
      <div class="actions">
        <button id="openGmail" class="btn primary"><svg class="ico"><use href="#i-mail"/></svg> Apri Gmail</button>
      </div>
    </div>
  </div>

  <div id="modalWA" class="modal hidden">
    <div class="dialog">
      <button class="close" data-close="modalWA">×</button>
      <h3>WhatsApp — Messaggio in tempo reale</h3>
      <div class="grid2">
        <label>Numero (con prefisso) <input id="waPhone" placeholder="es. 39333..."/></label>
        <label>Controllo <span id="waPhoneHint" style="display:block;color:#6b84b3;font-size:.85rem"></span></label>
      </div>
      <label>Messaggio
        <textarea id="waBody" rows="8" placeholder="Scrivi qui il messaggio..."></textarea>
      </label>
      <div style="display:flex;justify-content:space-between;align-items:center;margin:.4rem 0">
        <div>
          <button class="btn" id="waTplFreddo">Freddo</button>
          <button class="btn" id="waTplTiepido">Tiepido</button>
          <button class="btn" id="waTplCaldo">Caldo</button>
        </div>
        <div id="waCount" style="color:#6b84b3;font-weight:800">0 caratteri</div>
      </div>
      <div class="actions">
        <button class="btn" id="waSanitize">Pulisci/accorcia</button>
        <button class="btn primary" id="waOpen"><svg class="ico"><use href="#i-wa"/></svg> Apri WhatsApp</button>
      </div>
    </div>
  </div>

  <div id="modalPopup" class="modal hidden">
    <div class="dialog">
      <button class="close" data-close="modalPopup">×</button>
      <h3>Pop-up bloccati</h3>
      <p>Per completare l’azione devi <b>attivare i pop-up</b> per Gmail/WhatsApp.</p>
      <ul class="list" style="margin-top:.5rem">
        <li>Fai clic sull’icona a forma di blocco nella barra degli indirizzi</li>
        <li>Consenti pop-up e reindirizzamenti</li>
        <li>Ripeti l’azione</li>
      </ul>
      <div class="actions">
        <button class="btn primary" data-close="modalPopup">Ok</button>
      </div>
    </div>
  </div>

  <div id="modalWAConnect" class="modal hidden">
    <div class="dialog">
      <button class="close" data-close="modalWAConnect">×</button>
      <h3>Collegamento WhatsApp</h3>
      <ol style="margin:.5rem 0 1rem 1.2rem;color:#4b5f8f">
        <li>Apri WhatsApp Web/Desktop</li>
        <li>Se richiesto, scansiona il QR dal tuo telefono</li>
        <li>Invia un messaggio di test da qui</li>
      </ol>
      <div class="actions" style="margin-bottom:.6rem">
        <button class="btn" id="waOpenWeb">Apri WhatsApp Web</button>
      </div>
      <div class="grid2">
        <label>Numero test <input id="waTestPhone" placeholder="es. 39333..."/></label>
        <label>Messaggio test <input id="waTestMsg" placeholder="Ciao, test dal copilot"/></label>
      </div>
      <div class="actions">
        <button class="btn primary" id="waSendTest">Invia test</button>
      </div>
    </div>
  </div>

  <!-- TEMPLATE CARD -->
  <template id="tpl-card">
    <li class="lead-card" draggable="true">
      <div class="head">
        <div class="title"></div>
        <div class="heat dot"></div>
      </div>
      <div class="meta"></div>
      <div class="tags"></div>
      <div class="actions"></div>
    </li>
  </template>

  <div id="toast" class="toast"></div>

  <script src="script.js"></script>
</body>
</html>
